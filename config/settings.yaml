app:
  name: "Modular RAG Console"

paths:
  docs_dir: "data/docs"
  vector_store_dir: "data/vector_store"
  file_registry: "data/file_registry.json"

logging:
  level: "INFO"
  format: "[%(asctime)s] [%(levelname)s] %(name)s - %(message)s"
  file: "logs/prototype.log"
  extended: true

ingestion:
  chunk_size: 800
  chunk_overlap: 150
  retriever_k: 15
  glob_patterns:
    - "*.pdf"
    - "*.txt"
    - "*.md"

vector_store:
  collection_name: "rag_documents"
  recreate: false
  embedding_batch_size: 64

embeddings:
  model_name: "BAAI/bge-m3"
  # Device options: "cuda" (NVIDIA GPU), "mps" (Apple Silicon), "cpu", or "auto"
  device: "mps"
  normalize_embeddings: true

llm:
  provider: "google"
  model_name: "models/gemini-flash-latest"
  temperature: 0.2
  max_output_tokens: 8192
  api_key_env: "GOOGLE_API_KEY"

modules:
  rewriter: true
  hyde: true
  reranker: true
  parent_page_retriever: false

rewriter:
  enabled: true
  prompt_template: |-
    You are a Universal Search Query Optimizer.
    
    Goal: Refine the user's input to maximize retrieval accuracy from a vector database containing documents from VARIOUS domains (General, Technical, Legal, Scientific, etc.).

    Internal Reasoning (for 'rationale'):
    1. Identify Core Entities: What is the main subject?
    2. Infer Context: What vocabulary is typically used in documents discussing this subject?
    3. Safety Check: If the intent is ambiguous, DO NOT add guessed keywords to avoid vector drift.

    Directives:
    1. PRESERVE LANGUAGE: Russian -> Russian, English -> English.
    2. STRIP NOISE: Remove conversational fillers ("Hello", "find me").
    3. CONTEXTUAL EXPANSION: Add 2-3 high-value keywords that are semantically necessary for the answer.
       - Example (Medical): "headache" -> add "migraine symptoms treatment"
       - Example (Legal): "tenant didn't pay" -> add "lease agreement eviction breach"
       - Example (General): "best time to visit Japan" -> add "weather seasons tourism"
    4. FORMULATION: Output a keyword-dense string.

    Few-Shot Examples:

    User: "почему не заводится машина зимой?"
    Result: {{
      "rationale": "Subject: Car maintenance. Context: Automotive/Mechanics. Keywords: Battery, Spark plugs, Oil viscosity.",
      "rewrite_decision": "rewrite",
      "retriever_query": "машина не заводится зимой причины аккумулятор свечи масло стартер",
      "hyde_query": "Руководство по диагностике запуска двигателя при низких температурах"
    }}

    User: "refund policy for digital goods"
    Result: {{
      "rationale": "Subject: E-commerce/Legal. Context: Terms of Service. Keywords: Return, Period, Exceptions.",
      "rewrite_decision": "rewrite",
      "retriever_query": "refund policy digital goods return terms non-refundable conditions",
      "hyde_query": "Standard terms and conditions regarding refunds for digital products"
    }}

hyde:
  enabled: true
  prompt_template: |-
    You are a Knowledge Base Simulator.
    Task: Write a hypothetical document snippet that provides the PERFECT answer to the User Question.
    
    Critical Rule: ADAPT YOUR STYLE TO THE QUESTION'S DOMAIN.
    - If the question is scientific -> write like a research paper.
    - If the question is casual -> write like a helpful blog post or FAQ.
    - If the question is legal -> write like a contract or law text.
    
    Guidelines:
    1. Language: STRICTLY matches the User Question.
    2. Length: 1 concise paragraph (high information density).
    3. Content: Use vocabulary and phrasing typical for the implied topic. DO NOT converse with the user.

    Examples:
    
    Question: "How to center a div?"
    Hypothetical Snippet: "To center a div element horizontally and vertically using Flexbox, apply 'display: flex', 'justify-content: center', and 'align-items: center' to the parent container. Alternatively, CSS Grid can be used..."
    
    Question: "Симптомы гриппа"
    Hypothetical Snippet: "Клиническая картина гриппа характеризуется острым началом, повышением температуры тела до 38-40°C, ознобом, головной болью, миалгией и общей слабостью. Катаральные явления часто присоединяются позже..."

    Hypothetical Snippet:
  max_tokens: 2048

generator:
  max_context_documents: 8
  answer_prompt: |-
    You are a precise QA Assistant responsible for answering questions based ONLY on the provided Context Documents.

    Instructions:
    1. Analyze the User Question and the provided Context snippets.
    2. Synthesize an answer based strictly on the facts found in the Context.
    3. If the Context does not contain the answer, state: "The provided documents do not contain information to answer this question." Do not make up information.
    4. Always cite your sources using the format [source_filename (p.X)].
    5. Maintain the language of the User Question in your response.

    Tone: Professional, factual, concise.
  citations_required: true

reranker:
  enabled: true
  model_name: "BAAI/bge-reranker-v2-m3"
  top_k: 8

