app:
  name: "Modular RAG Console"

paths:
  docs_dir: "data/docs"
  vector_store_dir: "data/vector_store"
  file_registry: "data/file_registry.json"

logging:
  level: "INFO"
  format: "[%(asctime)s] [%(levelname)s] %(name)s - %(message)s"
  file: "logs/prototype.log"
  extended: true

ingestion:
  chunk_size: 800
  chunk_overlap: 150
  retriever_k: 15
  glob_patterns:
    - "*.pdf"
    - "*.txt"
    - "*.md"

vector_store:
  collection_name: "rag_documents"
  recreate: false
  embedding_batch_size: 64

embeddings:
  model_name: "BAAI/bge-m3"
  # Device options: "cuda" (NVIDIA GPU), "mps" (Apple Silicon), "cpu", or "auto"
  device: "mps"
  normalize_embeddings: true

llm:
  provider: "google"
  model_name: "models/gemini-flash-latest"
  temperature: 0.2
  max_output_tokens: 8192
  api_key_env: "GOOGLE_API_KEY"

modules:
  rewriter: false
  hyde: false
  reranker: true
  parent_page_retriever: false

rewriter:
  enabled: true
  prompt_template: |-
    You are an expert Search Query Optimizer. Your goal is to refine user questions for a semantic search engine.

    Input Analysis:
    1. Read the user's query carefully.
    2. Identify ambiguous pronouns (it, he, they), missing context, or casual phrasing.
    3. Detect the language of the user's query.

    Actions:
    - If the query is specific and clear (contains identifiers, specific terms, names like "Loginov", "GOST", "ISO"):
      Set "rewrite_decision" to "use_original".
    - If the query is vague or relies on previous context that is missing:
      Rewrite it to be self-contained and specific.
      CRITICAL: The rewritten query MUST be in the SAME LANGUAGE as the original user query.

    HyDE Directive (only if {{hyde_enabled}} is true):
    - Create a short instruction for a technical writer to draft an answer document.
    - Example: "Write a technical description of the X standard."

    Output Format:
    Return strictly a JSON object matching the provided schema.
    - rationale: Brief explanation of why you rewrote or kept the original.
    - retriever_query: Self-contained query to send to the dense retriever.
    - hyde_query: Directive for the HyDE module when enabled, else empty.

hyde:
  enabled: true
  prompt_template: |-
    You are an Expert Technical Writer tasked with drafting a snippet for a documentation knowledge base.
    
    Task:
    Based on the User Question and the optional Directive, write a HYPOTHETICAL document passage that answers the question.
    
    Rules:
    1. Do NOT converse with the user. Do NOT say "Here is the answer".
    2. Write only the content of the hypothetical document passage.
    3. Use professional, technical language.
    4. Include plausible keywords related to the topic (e.g., standard codes, technical terms).
    5. Keep it under 5-6 sentences.
    6. MUST be in the SAME LANGUAGE as the Original Question.

    Context:
  max_tokens: 2048

generator:
  max_context_documents: 8
  answer_prompt: |-
    You are a precise QA Assistant responsible for answering questions based ONLY on the provided Context Documents.

    Instructions:
    1. Analyze the User Question and the provided Context snippets.
    2. Synthesize an answer based strictly on the facts found in the Context.
    3. If the Context does not contain the answer, state: "The provided documents do not contain information to answer this question." Do not make up information.
    4. Always cite your sources using the format [source_filename (p.X)].
    5. Maintain the language of the User Question in your response.

    Tone: Professional, factual, concise.
  citations_required: true

reranker:
  enabled: true
  model_name: "BAAI/bge-reranker-v2-m3"
  top_k: 8

